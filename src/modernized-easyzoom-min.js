export default class EasyZoom{constructor(t,e={}){this.target=t,this.opts={...EasyZoom.defaults,...e,...this.getDataOptions()},this._init()}static defaults={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,linkAttribute:"href",preventClicks:!0,onShow:()=>{},onHide:()=>{},onMove:()=>{}};getDataOptions(){const t=this.target.dataset,e={};for(const[i,s]of Object.entries(t))e[i]="true"===s||"false"!==s&&s;return e}_init(){this.isOpen=!1,this.isReady=!1,this.link=this.target.querySelector("a"),this.image=this.target.querySelector("img"),this.flyout=document.createElement("div"),this.flyout.className="easyzoom-flyout",this.target.style.position="relative",this.target.appendChild(this.flyout),this.target.addEventListener("mouseenter",this._onEnter.bind(this)),this.target.addEventListener("mousemove",this._onMove.bind(this)),this.target.addEventListener("mouseleave",this._onLeave.bind(this)),this.target.addEventListener("touchstart",this._onEnter.bind(this)),this.target.addEventListener("touchmove",this._onMove.bind(this)),this.target.addEventListener("touchend",this._onLeave.bind(this)),this.link.addEventListener("click",(t=>{t.preventDefault()})),this._loadZoomImage()}_loadZoomImage(){this.zoomImg=new Image,this.zoomImg.src=this.link.getAttribute(this.opts.linkAttribute),this.zoomImg.onload=()=>{this.isReady=!0,this.flyout.appendChild(this.zoomImg),this.zoomImg.style.position="absolute"}}_onEnter(t){t.preventDefault(),this.isReady&&(this.isOpen=!0,this.target.classList.add("is-active"),this._move(t))}_onMove(t){t.preventDefault(),this.isOpen&&this.isReady&&this._move(t)}_onLeave(t){this.isOpen=!1,this.target.classList.remove("is-active")}_move(t){let e,i;if(t.type.startsWith("touch")){const s=t.touches[0]||t.changedTouches[0];e=s.clientX,i=s.clientY}else e=t.clientX,i=t.clientY;const s=this.target.getBoundingClientRect(),o=Math.max(0,Math.min(1,(e-s.left)/s.width)),n=Math.max(0,Math.min(1,(i-s.top)/s.height)),h=this.zoomImg.width-this.flyout.offsetWidth,a=this.zoomImg.height-this.flyout.offsetHeight,r=Math.max(-h,Math.min(0,-h*o)),m=Math.max(-a,Math.min(0,-a*n));this.zoomImg.style.transform=`translate(${r}px, ${m}px)`,this.opts.onMove.call(this,r,m)}teardown(){this.target.removeEventListener("mouseenter",this._onEnter),this.target.removeEventListener("mousemove",this._onMove),this.target.removeEventListener("mouseleave",this._onLeave),this.target.removeEventListener("touchstart",this._onEnter),this.target.removeEventListener("touchmove",this._onMove),this.target.removeEventListener("touchend",this._onLeave),this.flyout.remove()}swap(t,e){this.isReady=!1,this.image.src=t,this.link.setAttribute(this.opts.linkAttribute,e);const i=new Image;i.src=e,i.onload=()=>{this.zoomImg=i,this.zoomImg.style.position="absolute",this.flyout.innerHTML="",this.flyout.appendChild(this.zoomImg),this.isReady=!0}}}