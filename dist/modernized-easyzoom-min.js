export default class EasyZoom{constructor(t,e={}){this.target=t,this.opts={...EasyZoom.defaults,...e,...this.getDataOptions()},this._init()}static defaults={loadingNotice:"Loading image",errorNotice:"The image could not be loaded",errorDuration:2500,linkAttribute:"href",preventClicks:!0,beforeShow:()=>{},beforeHide:()=>{},onShow:()=>{},onHide:()=>{},onMove:()=>{}};getDataOptions(){const t=this.target.dataset,e={};for(const[i,s]of Object.entries(t))e[i]="true"===s||"false"!==s&&s;return e}_init(){this.isOpen=!1,this.isReady=!1,this.link=this.target.querySelector("a"),this.image=this.target.querySelector("img"),this.flyout=document.createElement("div"),this.flyout.className="easyzoom-flyout",this.target.style.position="relative",this.target.appendChild(this.flyout),this.target.addEventListener("mouseenter",this._onEnter.bind(this)),this.target.addEventListener("mousemove",this._onMove.bind(this)),this.target.addEventListener("mouseleave",this._onLeave.bind(this))}_onEnter(t){this.isReady?(this.isOpen=!0,this.target.classList.add("is-active"),this._move(t)):this._loadZoomImage((()=>{this.isOpen=!0,this.target.classList.add("is-active"),this._move(t)}))}_loadZoomImage(t){this.isReady?t():(this.zoomImg=new Image,this.zoomImg.src=this.link.getAttribute(this.opts.linkAttribute),this.zoomImg.onload=()=>{this.isReady=!0,this.flyout.appendChild(this.zoomImg),this.zoomImg.style.position="absolute",t()})}_onMove(t){this.isOpen&&this.isReady&&this._move(t)}_onLeave(){this.isOpen=!1,this.target.classList.remove("is-active")}_move(t){const e=this.target.getBoundingClientRect(),i=(t.clientX-e.left)/e.width,s=(t.clientY-e.top)/e.height,o=-(this.zoomImg.width-this.flyout.offsetWidth)*i,a=-(this.zoomImg.height-this.flyout.offsetHeight)*s;this.zoomImg.style.transform=`translate(${o}px, ${a}px)`,this.opts.onMove.call(this,o,a)}teardown(){this.target.removeEventListener("mouseenter",this._onEnter),this.target.removeEventListener("mousemove",this._onMove),this.target.removeEventListener("mouseleave",this._onLeave),this.flyout.remove()}swap(t,e){this.isReady=!1,this.image.src=t,this.link.setAttribute(this.opts.linkAttribute,e)}}